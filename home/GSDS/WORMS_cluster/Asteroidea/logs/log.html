<html><body>
<br><b>Harvesting...</b>\n<pre>
</pre><hr><b>File format conversions...</b>\n<pre>
Unzipping
Archive:  WoRMS_Asteroidea.zip
  inflating: AcceptedSpecies.txt     
  inflating: AcceptedInfraSpecificTaxa.txt  
  inflating: Synonyms.txt            
  inflating: CommonNames.txt         
  inflating: Distribution.txt        
  inflating: References.txt          
  inflating: NameReferencesLinks.txt  
  inflating: SourceDatabase.txt      
Skipping format conversion
</pre><hr><b>Creating buffer database, performing structural transformations...</b>\n<pre>
<pre>
Initiating buffer creation - this may take a while depending on size of the dataset...\n
Creating buffer database Buffer_Asteroidea in schema as provided by Asteroidea
--------------
DROP DATABASE IF EXISTS Buffer_Asteroidea
--------------

--------------
CREATE DATABASE IF NOT EXISTS Buffer_Asteroidea
--------------

--------------
CREATE TABLE `AcceptedInfraSpecificTaxa` (
`AcceptedTaxonID` varchar(50) PRIMARY KEY,
`ParentSpeciesID` varchar(50) default NULL,
`InfraSpeciesEpithet` varchar(50) default NULL,
`InfraSpecificAuthorString` varchar(50) default NULL,
`InfraSpecificMarker` varchar(10) default NULL,
`GSDNameStatus` varchar(50) default NULL,
`Sp2000NameStatus` varchar(50) default NULL,
`IsFossil` tinyint(1) default NULL,
`LifeZone` varchar(50) default NULL,
`AdditionalData` varchar(255) default NULL,
`LTSSpecialist` varchar(255)  CHARACTER SET utf8 COLLATE utf8_general_ci default NULL,
`LTSDate` varchar(50) default NULL,
`InfraSpeciesURL` varchar(255) default NULL,
`GSDTaxonGUI` varchar(255) default NULL,
`GSDNameGUI`  varchar(255) default NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8
--------------

--------------
CREATE TABLE `AcceptedSpecies` (
`AcceptedTaxonID` varchar(50) PRIMARY KEY,
`Kingdom` varchar(50) default NULL,
`Phylum` varchar(50) default NULL,
`Class` varchar(50) default NULL,
`Order` varchar(50) default NULL,
`Superfamily` varchar(50) default NULL,
`Family` varchar(50) default NULL,
`Genus` varchar(50) default NULL,
`SubGenusName` varchar(50) default NULL,
`Species` varchar(50) default NULL,
`AuthorString` varchar(50)  CHARACTER SET utf8 COLLATE utf8_general_ci default NULL,
`GSDNameStatus` varchar(50) default NULL,
`Sp2000NameStatus` varchar(50) default NULL,
`IsFossil` tinyint(1) default NULL,
`LifeZone` varchar(50) default NULL,
`AdditionalData` varchar(255) default NULL,
`LTSSpecialist` varchar(255)  CHARACTER SET utf8 COLLATE utf8_general_ci default NULL,
`LTSDate` varchar(50) default NULL,
`SpeciesURL` varchar(255) default NULL,
`GSDTaxonGUI` varchar(255) default NULL,
`GSDNameGUI` varchar(255) default NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8
--------------

--------------
CREATE TABLE `CommonNames` (
`record_id` int(10) unsigned NOT NULL AUTO_INCREMENT,
`AcceptedTaxonID` varchar(50) NOT NULL,
`CommonName` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
`Transliteration` varchar(255) default NULL,
`Language` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci default NULL,
`Country`  varchar(255) default NULL,
`Area`  varchar(255) default NULL,
`ReferenceID` varchar(50) default NULL,
PRIMARY KEY (`record_id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE = utf8_general_ci
--------------

--------------
CREATE TABLE `Distribution` (
`record_id` int(10) unsigned NOT NULL AUTO_INCREMENT,
`AcceptedTaxonID` varchar(50) NOT NULL,
`Distribution` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
`StandardInUse` varchar(50) default NULL,
`DistributionStatus` varchar(50) default NULL,
PRIMARY KEY (`record_id`) 
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE = utf8_general_ci
--------------

--------------
CREATE TABLE `References` (
`ReferenceID` varchar(50) PRIMARY KEY,
`Authors` varchar(255)  CHARACTER SET utf8 COLLATE utf8_general_ci default NULL,
`Year` varchar(255) default NULL,
`Title` varchar(255)  CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
`Details` varchar(255) default NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8
--------------

--------------
CREATE TABLE `NameReferencesLinks` (
`ID` integer(10) PRIMARY KEY,
`ReferenceType` varchar(50) default NULL,
`ReferenceID` varchar(50) NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8
--------------

--------------
CREATE TABLE `SourceDatabase` (
`record_id` int(10) unsigned NOT NULL AUTO_INCREMENT,
`DatabaseFullName` varchar(255) NOT NULL,
`DatabaseShortName` varchar(50) NOT NULL,
`DatabaseVersion` varchar(50) NOT NULL,
`ReleaseDate` varchar(50) NOT NULL,
`AuthorsEditors` varchar(255)  CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
`TaxonomicCoverage` varchar(255) NOT NULL,
`GroupNameInEnglish` varchar(255) NOT NULL,
`Abstract` text  CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
`Organisation` varchar(255) NOT NULL,
`HomeURL` varchar(255) default NULL,
`Coverage` varchar(50) default NULL,
`Completeness` integer(3) default NULL,
`Confidence` integer(1) default NULL,
`LogoFileName`  varchar(255) default NULL,
`ContactPerson` varchar(255)  CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
PRIMARY KEY (`record_id`) 
) ENGINE=MyISAM DEFAULT CHARSET=utf8
--------------

--------------
CREATE TABLE `Synonyms` (
`ID` integer(10) PRIMARY KEY,
`AcceptedTaxonID` varchar(50) NOT NULL,
`Genus` varchar(50) NOT NULL,
`SubGenusName` varchar(50) default NULL,
`Species` varchar(50) NOT NULL,
`AuthorString` varchar(50)  CHARACTER SET utf8 COLLATE utf8_general_ci default NULL,
`InfraSpecies` varchar(50) default NULL,
`InfraSpecificMarker` varchar(50) default NULL,
`InfraSpecificAuthorString`  varchar(50)  CHARACTER SET utf8 COLLATE utf8_general_ci default NULL,
`GSDNameStatus` varchar(50) default NULL,
`Sp2000NameStatus` varchar(50) default NULL,
`GSDNameGUI` varchar(255) default NULL 
) ENGINE=MyISAM DEFAULT CHARSET=utf8
--------------

--------------
LOAD DATA LOCAL INFILE 'AcceptedInfraSpecificTaxa.txt' INTO TABLE `AcceptedInfraSpecificTaxa` CHARACTER SET utf8 FIELDS TERMINATED BY '\t'  LINES TERMINATED BY '\r\n' IGNORE 1 LINES 
(`AcceptedTaxonID`, `ParentSpeciesID`, `InfraSpeciesEpithet`, `InfraSpecificAuthorString`,  `InfraSpecificMarker`, `GSDNameStatus`,  `Sp2000NameStatus`, `IsFossil`, `LifeZone`, `AdditionalData`, `LTSSpecialist`, `LTSDate`, `InfraSpeciesURL`, `GSDTaxonGUI`, `GSDNameGUI`)
--------------

--------------
LOAD DATA LOCAL INFILE 'AcceptedSpecies.txt' INTO TABLE `AcceptedSpecies` CHARACTER SET utf8 FIELDS TERMINATED BY '\t'  LINES TERMINATED BY '\r\n'  IGNORE 1 LINES
(`AcceptedTaxonID`, `Kingdom`, `Phylum`, `Class`, `Order`, `Superfamily`, `Family`, `Genus`, `SubGenusName`, `Species`, `AuthorString`, `GSDNameStatus`, `Sp2000NameStatus`, `IsFossil`, `LifeZone`, `AdditionalData`, `LTSSpecialist`, `LTSDate`, `SpeciesURL`, `GSDTaxonGUI`, `GSDNameGUI`)
--------------

--------------
LOAD DATA LOCAL INFILE 'CommonNames.txt' INTO TABLE `CommonNames` CHARACTER SET utf8 FIELDS TERMINATED BY '\t'  LINES TERMINATED BY '\r\n'  IGNORE 1 LINES
(`AcceptedTaxonID`, `CommonName`, `Transliteration`, `Country`, `Area`, `Language`, `ReferenceID`)
--------------

--------------
LOAD DATA LOCAL INFILE 'Distribution.txt' INTO TABLE `Distribution` CHARACTER SET utf8 FIELDS TERMINATED BY '\t'  LINES TERMINATED BY '\r\n'  IGNORE 1 LINES
(`AcceptedTaxonID`, `Distribution`, `StandardInUse`, `DistributionStatus`)
--------------

--------------
LOAD DATA LOCAL INFILE 'NameReferencesLinks.txt' INTO TABLE NameReferencesLinks CHARACTER SET utf8 FIELDS TERMINATED BY '\t'  LINES TERMINATED BY '\r\n' IGNORE 1 LINES
(`ID`, `ReferenceType`, `ReferenceID`)
--------------

--------------
LOAD DATA LOCAL INFILE 'References.txt' INTO TABLE `References` CHARACTER SET utf8 FIELDS TERMINATED BY '\t'  LINES TERMINATED BY '\r\n' IGNORE 1 LINES
(`ReferenceID`, `Authors`, `Year`, `Title`, `Details`)
--------------

--------------
LOAD DATA LOCAL INFILE 'SourceDatabase.txt' INTO TABLE `SourceDatabase` CHARACTER SET utf8 FIELDS TERMINATED BY '\t'  LINES TERMINATED BY '\r\n' IGNORE 1 LINES
(`DatabaseFullName`, `DatabaseShortName`, `DatabaseVersion`, `ReleaseDate`, `AuthorsEditors`, `TaxonomicCoverage`, `GroupNameInEnglish`, `Abstract`, `Organisation`, `HomeURL`, `Coverage`, `Completeness`, `Confidence`, `LogoFileName`, `ContactPerson`)
--------------

--------------
LOAD DATA LOCAL INFILE 'Synonyms.txt' INTO TABLE `Synonyms` CHARACTER SET utf8 FIELDS TERMINATED BY '\t'  LINES TERMINATED BY '\r\n' IGNORE 1 LINES
(`ID`, `AcceptedTaxonID`, `Genus`, `SubGenusName`, `Species`, `AuthorString`, `InfraSpecies`, `InfraSpecificMarker`, `InfraSpecificAuthorString`, `GSDNameStatus`, `Sp2000NameStatus`, `GSDNameGUI`)
--------------

\n\n\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\n\n
Initial database created. Creating database Assembly_Asteroidea in assembly schema
--------------
DROP DATABASE IF EXISTS Assembly_Asteroidea
--------------

--------------
CREATE DATABASE IF NOT EXISTS Assembly_Asteroidea
--------------

--------------
DROP TABLE IF EXISTS `databases`
--------------

--------------
CREATE TABLE  `databases` (
  `database_name_displayed` varchar(125) DEFAULT NULL,
  `record_id` int(10) NOT NULL AUTO_INCREMENT,
  `database_name` varchar(150) DEFAULT NULL,
  `database_full_name` varchar(100) NOT NULL DEFAULT '',
  `web_site` longtext,
  `organization` longtext,
  `contact_person` varchar(255) DEFAULT NULL,
  `taxa` varchar(255) DEFAULT NULL,
  `taxonomic_coverage` longtext,
  `abstract` longtext,
  `version` varchar(255) DEFAULT NULL,
  `release_date` date DEFAULT '0000-00-00',
  `SpeciesCount` int(11) DEFAULT 0,
  `SpeciesEst` int(11) DEFAULT 0,
  `authors_editors` longtext,
  `accepted_species_names` int(10) DEFAULT 0,
  `accepted_infraspecies_names` int(10) DEFAULT 0,
  `species_synonyms` int(10) DEFAULT 0,
  `infraspecies_synonyms` int(10) DEFAULT 0,
  `common_names` int(10) DEFAULT 0,
  `total_names` int(10) DEFAULT 0,
  `is_new` tinyint(1) NOT NULL DEFAULT 0,
  `coverage` varchar(45) DEFAULT NULL,
  `completeness` int(3) unsigned DEFAULT 0,
  `confidence` 	tinyint(1) unsigned DEFAULT 0,
  PRIMARY KEY (`record_id`),
  KEY `database_name` (`database_name`)
) ENGINE=MyISAM DEFAULT CHARACTER SET = utf8 COLLATE = utf8_bin
--------------

--------------
DROP TABLE IF EXISTS `families`
--------------

--------------
CREATE TABLE  `families` (
  `record_id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `hierarchy_code` varchar(250) NOT NULL,
  `kingdom` varchar(50) NOT NULL DEFAULT 'Not Assigned',
  `phylum` varchar(50) NOT NULL DEFAULT ' Not Assigned ',
  `class` varchar(50) NOT NULL DEFAULT ' Not Assigned ',
  `order` varchar(50) NOT NULL DEFAULT ' Not Assigned ',
  `family` varchar(50) NOT NULL DEFAULT ' Not Assigned ',
  `superfamily` varchar(50) DEFAULT NULL,
  `database_id` int(10) NOT NULL,
  `family_code` varchar(50) NOT NULL,
  `is_accepted_name` int(1) unsigned,
  PRIMARY KEY (`record_id`),
  KEY (`family_code`),
  KEY `kingdom` (`kingdom`),
  KEY `phylum` (`phylum`),
  KEY `class` (`class`),
  KEY `order` (`order`),
  KEY `family` (`family`),
  KEY `superfamily` (`superfamily`)
) ENGINE=MyISAM DEFAULT CHARACTER SET = utf8 COLLATE = utf8_bin
--------------

--------------
DROP TABLE IF EXISTS `sp2000_statuses`
--------------

--------------
CREATE TABLE  `sp2000_statuses` (
  `record_id` int(1) NOT NULL AUTO_INCREMENT,
  `sp2000_status` varchar(50) NOT NULL DEFAULT '',
  PRIMARY KEY (`record_id`)
) ENGINE=MyISAM
--------------

--------------
DROP TABLE IF EXISTS `scientific_names`
--------------

--------------
CREATE TABLE  `scientific_names` (
  `record_id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name_code` varchar(42) NOT NULL,
  `web_site` longtext,
  `genus` varchar(50) DEFAULT NULL,
  `subgenus` varchar(50) DEFAULT NULL,
  `species` varchar(60) DEFAULT NULL,
  `infraspecies_parent_name_code` varchar(42) DEFAULT NULL,
  `infraspecies` varchar(50) DEFAULT NULL,
  `infraspecies_marker` varchar(50) DEFAULT NULL,
  `author` varchar(100) DEFAULT NULL,
  `accepted_name_code` varchar(42) DEFAULT NULL,
  `comment` longtext,
  `scrutiny_date` text,
  `sp2000_status_id` int(1) DEFAULT NULL,
  `database_id` int(10) DEFAULT NULL,
  `specialist_id` int(10) DEFAULT NULL,
  `family_id` int(10) DEFAULT NULL,
  `specialist_code` varchar(50) DEFAULT NULL,
  `family_code` varchar(50) DEFAULT NULL,
  `is_accepted_name` int(1) DEFAULT NULL,
  `GSDTaxonGUID` longtext,
  `GSDNameGUID` longtext,
  PRIMARY KEY (`record_id`,`name_code`),
  KEY `database_id` (`database_id`),
  KEY `family_id` (`family_id`),
  KEY `species` (`species`),
  KEY `infraspecies` (`infraspecies`),
  KEY `accepted_name_code` (`accepted_name_code`),
  KEY `infraspecies_parent_name_code` (`infraspecies_parent_name_code`),
  KEY `name_code1` (`name_code`,`family_id`),
  KEY `record_id` (`record_id`,`family_id`),
  KEY `genus` (`genus`,`species`,`infraspecies`),
  KEY `sp2000_status_id` (`sp2000_status_id`),
  KEY `sp2000_status_id_2` (`sp2000_status_id`,`database_id`,`infraspecies`)
) ENGINE=MyISAM DEFAULT CHARACTER SET = utf8 COLLATE = utf8_bin
--------------

--------------
DROP TABLE IF EXISTS `common_names`
--------------

--------------
CREATE TABLE  `common_names` (
  `record_id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name_code` varchar(42) NOT NULL DEFAULT '',
  `common_name` varchar(700) NOT NULL,
  `transliteration` varchar(700),
  `language` varchar(25) NOT NULL,
  `country` varchar(44) NOT NULL DEFAULT '',
  `area` varchar(50) DEFAULT NULL,
  `reference_id` int(10) DEFAULT '0',
  `database_id` int(10) NOT NULL,
  `is_infraspecies` int(1) NOT NULL DEFAULT '0',
  `reference_code` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`record_id`),
  KEY `common_name` (`common_name`),
  KEY `name_code` (`name_code`)
) ENGINE=MyISAM DEFAULT CHARACTER SET = utf8 COLLATE = utf8_bin
--------------

--------------
DROP TABLE IF EXISTS `distribution`
--------------

--------------
CREATE TABLE  `distribution` (
  `record_id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name_code` varchar(42) NOT NULL,
  `distribution` longtext,
  `StandardInUse` varchar(255) DEFAULT NULL,
  
   `DistributionStatus` varchar(255),
  `database_id` int(10) NOT NULL,
  PRIMARY KEY (`record_id`),
  KEY `name_code` (`name_code`),
  KEY `database_id` (`database_id`)
) ENGINE=MyISAM DEFAULT CHARACTER SET = utf8 COLLATE = utf8_bin
--------------

--------------
DROP TABLE IF EXISTS `lifezone`
--------------

--------------
CREATE TABLE  `lifezone` (
  `record_id` int(11) NOT NULL AUTO_INCREMENT,
  `name_code` varchar(42),
  `lifezone` varchar(255),
  `database_id` int(10),
  PRIMARY KEY (`record_id`),
  KEY `name_code` (`name_code`),
  KEY `database_id` (`database_id`)
) ENGINE=MyISAM DEFAULT CHARACTER SET = utf8 COLLATE = utf8_bin
--------------

--------------
DROP TABLE IF EXISTS `scientific_name_references`
--------------

--------------
CREATE TABLE  `scientific_name_references` (
  `record_id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name_code` varchar(42) NOT NULL DEFAULT '',
  `reference_type` varchar(10) DEFAULT NULL,
  `reference_id` int(10) DEFAULT '0',
  `reference_code` varchar(50) DEFAULT NULL,
  `database_id` int(10) NOT NULL,
  PRIMARY KEY (`record_id`),
  KEY `name_code` (`name_code`,`reference_id`,`reference_type`),
  KEY `name_code_2` (`name_code`,`reference_type`)
) ENGINE=MyISAM DEFAULT CHARACTER SET = utf8 COLLATE = utf8_bin
--------------

--------------
DROP TABLE IF EXISTS `references`
--------------

--------------
CREATE TABLE  `references` (
  `record_id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `author` varchar(200) DEFAULT NULL,
  `year` varchar(50) DEFAULT NULL,
  `title` longtext,
  `source` longtext,
  `database_id` int(10) NOT NULL,
  `reference_code` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`record_id`)
) ENGINE=MyISAM DEFAULT CHARACTER SET = utf8 COLLATE = utf8_bin
--------------

--------------
DROP TABLE IF EXISTS `specialists`
--------------

--------------
CREATE TABLE  `specialists` (
  `record_id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `specialist_name` varchar(255) NOT NULL DEFAULT '',
  `specialist_code` varchar(50) DEFAULT NULL,
  `database_id` int(10) NOT NULL,
  PRIMARY KEY (`record_id`)
) ENGINE=MyISAM DEFAULT CHARACTER SET = utf8 COLLATE = utf8_bin
--------------

--------------
INSERT INTO `sp2000_statuses` 
VALUES (1,'accepted name'),
(2,'ambiguous synonym'),
(3,'misapplied name'),
(4,'provisionally accepted name'),
(5,'synonym')
--------------

--------------
DROP TRIGGER IF EXISTS delfamcascade
--------------

--------------
DROP TRIGGER IF EXISTS delspcascade
--------------

--------------
DROP TRIGGER IF EXISTS delrefscascade
--------------

--------------
CREATE TRIGGER delfamcascade AFTER DELETE ON `families`
FOR EACH ROW 
BEGIN

DELETE FROM `scientific_names` WHERE family_code = old.family_code;

END;

CREATE TRIGGER delspcascade AFTER DELETE ON `scientific_names`
FOR EACH ROW 
BEGIN

DELETE FROM `common_names` WHERE name_code = old.name_code;
DELETE FROM `distribution` WHERE name_code = old.name_code;
DELETE FROM `lifezone` WHERE name_code = old.name_code;
DELETE FROM `scientific_name_references` WHERE name_code = old.name_code;
DELETE FROM `common_names` WHERE name_code = old.name_code;

END;

CREATE TRIGGER delrefscascade AFTER DELETE ON `scientific_name_references`
FOR EACH ROW 
BEGIN

DELETE FROM `references` WHERE reference_code = old.reference_code;

END;
--------------

\n\n\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\n\n
\nCreation of the assembly database completed.\n
Starting structural transformations (ACEF3 to ACI)
--------------
SET @dbid = 95
--------------

--------------
SET @dbabbr = 'W-Ase-'
--------------

--------------
SET @dbtouse = 'Buffer_Asteroidea'
--------------

--------------
SET foreign_key_checks = 0
--------------

--------------
TRUNCATE TABLE `databases`
--------------

--------------
SET @query = CONCAT("
INSERT INTO `databases` 
 SELECT
 CONCAT(`DatabaseShortName`, ': ', `DatabaseFullName`)  AS `database_name_displayed`,
 @dbid AS `record_id`,
 `DatabaseShortName` AS `database_name`,
 `DatabaseFullName` AS `database_full_name`,
  `HomeURL` AS `web_site`,
  `Organisation` AS `organization`,
  `ContactPerson` AS `contact_person`,
  `GroupNameInEnglish` AS `taxa`,
  `TaxonomicCoverage` AS `taxonomic_coverage`,
  `Abstract` AS `abstract`,
  `DatabaseVersion` AS `version`,
  `ReleaseDate` AS `release_date`,
  `Coverage` AS `SpeciesCount`,
  `Completeness` AS `SpeciesEst`,
  `AuthorsEditors` AS `authors_editors`,
  NULL AS `accepted_species_names`,
  NULL AS `accepted_infraspecies_names`,
  NULL AS `species_synonyms`,
  NULL AS `infraspecies_synonyms`,
  NULL AS `common_names`,
  NULL AS `total_names`,
  NULL AS `is_new`,
  NULL AS `coverage`,
  NULL AS `completeness`,
  NULL AS `confidence`
  FROM ",
@dbtouse,
".`SourceDatabase`")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
TRUNCATE TABLE `distribution`
--------------

--------------
SET @query = CONCAT("
INSERT INTO `distribution` 
 SELECT
 NULL AS `record_id`,
 CONCAT(@dbabbr, `AcceptedTaxonID`) AS `name_code`,
 `Distribution` AS `distribution`,
 `StandardInUse` AS `StandardInUse`, 
 `DistributionStatus` AS `DistributionStatus`,
@dbid AS `database_id`
 FROM ",
@dbtouse,
".`Distribution`")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
TRUNCATE TABLE `families`
--------------

--------------
SET @query = CONCAT("
INSERT INTO `families`
SELECT DISTINCT
NULL AS `record_id`,
NULL AS `hierarchy_code`,
`Kingdom` AS `kingdom`,
`Phylum` AS `phylum`,
`Class` AS `class`,
`Order` AS `order`,
`Family` AS `family`,
`Superfamily` AS `superfamily`,
@dbid AS `database_id`,
NULL AS `family_code`,
NULL AS `is_accepted_name`
FROM ",
@dbtouse,
".`AcceptedSpecies`")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
UPDATE `families` SET `family_code` = CONCAT(@dbabbr,record_id)
--------------

--------------
TRUNCATE TABLE `specialists`
--------------

--------------
SET @query = CONCAT("
INSERT INTO `specialists`
SELECT DISTINCT 
NULL  AS `record_id`,
`LTSSpecialist` AS `specialist_name`,
NULL AS `specialist_code`,
@dbid AS `database_id`
FROM ",
@dbtouse,
".`AcceptedSpecies` 
WHERE `LTSSpecialist` IS NOT NULL OR 
`LTSSpecialist` != ''")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
UPDATE `specialists` SET `specialist_code` = CONCAT(@dbabbr,record_id)
--------------

--------------
TRUNCATE TABLE `scientific_names`
--------------

--------------
SET @query = CONCAT("
INSERT INTO `scientific_names`
SELECT 
NULL AS `record_id`,
CONCAT(@dbabbr,`AcceptedTaxonID`) AS `name_code`,
`SpeciesURL` AS `web_site`,
`Genus` AS `genus`,
`SubGenusName` AS `subgenus`,
`Species` AS `species`,
NULL AS `infraspecies_parent_name_code`,
NULL  AS `infraspecies`,
NULL  AS `infraspecies_marker`,
`AuthorString` AS `author`,
CONCAT(@dbabbr,`AcceptedTaxonID`) AS `accepted_name_code`,
`AdditionalData` AS `comment`,
`LTSDate` AS `scrutiny_date`,
`sp2000_statuses`.`record_id` AS `sp2000_status_id`,
@dbid AS `database_id`,
`specialists`.`record_id` AS `specialist_id`,
`families`.`record_id` AS `family_id`,
`specialists`.`specialist_code` AS `specialist_code`,
`families`.`family_code` AS `family_code`,
1 AS `is_accepted_name`,
`GSDTaxonGUI` AS `GSDTaxonGUI`,
`GSDNameGUI` AS `GSDNameGUI`
FROM ",
@dbtouse,
".`AcceptedSpecies` AcceptedSpecies
LEFT OUTER JOIN `families` ON 
(`AcceptedSpecies`.`Kingdom` = `families`.`kingdom` AND
`AcceptedSpecies`.`Phylum` = `families`.`phylum` AND
`AcceptedSpecies`.`Class` = `families`.`class` AND
`AcceptedSpecies`.`Order` = `families`.`order` AND
`AcceptedSpecies`.`Superfamily` = `families`.`superfamily` AND
`AcceptedSpecies`.`Family` = `families`.`family`)
LEFT OUTER JOIN `specialists` ON
`AcceptedSpecies`.`LTSSpecialist` = `specialists`.`specialist_name`
LEFT OUTER JOIN `sp2000_statuses` ON
`AcceptedSpecies`.`Sp2000NameStatus` = `sp2000_statuses`.`sp2000_status`
WHERE `AcceptedSpecies`.`IsFossil` = 0")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
TRUNCATE TABLE `lifezone`
--------------

--------------
SET @query = CONCAT("
INSERT INTO `lifezone`
SELECT 
NULL AS `record_id`,
CONCAT(@dbabbr,`AcceptedTaxonID`) AS `name_code`,
`LifeZone` AS `lifezone`,
@dbid AS `database_id`
FROM ",
@dbtouse,
".`AcceptedSpecies`
WHERE `LifeZone` IN('marine','freshwater','Marine','Freshwater')")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
SET @query = CONCAT("
INSERT INTO `scientific_names`
SELECT 
NULL AS `record_id`,
CONCAT(@dbabbr,`AIT`.`AcceptedTaxonID`) AS `name_code`,
NULL AS `web_site`,
`sn`.`genus` AS `genus`,
NULL AS `subgenus`,
`sn`.`species` AS `species`,
CONCAT(@dbabbr,`AIT`.`ParentSpeciesID`) AS `infraspecies_parent_name_code`,
`AIT`.`InfraSpeciesEpithet` AS `infraspecies`,
`AIT`.`InfraSpecificMarker` AS `infraspecies_marker`,
`AIT`.`InfraSpecificAuthorString` AS `author`,
CONCAT(@dbabbr,`AIT`.`AcceptedTaxonID`) AS `accepted_name_code`,
`AIT`.`AdditionalData` AS `comment`,
`AIT`.`LTSDate` AS `scrutiny_date`,
`sp2000_statuses`.`record_id` AS `sp2000_status_id`,
@dbid AS `database_id`,
NULL AS `specialist_id`,
NULL AS `family_id`,
`specialists`.`specialist_code` AS `specialist_code`,
sn.family_code AS `family_code`,
1 AS `is_accepted_name`,
NULL AS `GSDTaxonGUI`,
`AIT`.`GSDNameGUI` AS `GSDNameGUI` 
FROM ",
@dbtouse,
".`AcceptedInfraSpecificTaxa` AIT
LEFT OUTER JOIN scientific_names sn ON
CONCAT(@dbabbr,`AIT`.`ParentSpeciesID`) = `sn`.`name_code`
LEFT OUTER JOIN `sp2000_statuses` ON
`AIT`.`Sp2000NameStatus` = `sp2000_statuses`.`sp2000_status`
LEFT OUTER JOIN `specialists` ON
`AIT`.`LTSSpecialist` = `specialists`.`specialist_name`")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
SET @query = CONCAT("
INSERT INTO `scientific_names`
SELECT 
NULL AS `record_id`,
CONCAT(@dbabbr,`Synonyms`.`ID`) AS `name_code`,
NULL AS `web_site`,
`Synonyms`.`Genus` AS `genus`,
`Synonyms`.`SubGenusName` AS `subgenus`,
`Synonyms`.`Species` AS `species`,
NULL AS `infraspecies_parent_name_code`,
`Synonyms`.`InfraSpecies` AS `infraspecies`,
`Synonyms`.`InfraSpecificMarker` AS `infraspecies_marker`,
`Synonyms`.`AuthorString` AS `author`,
CONCAT(@dbabbr,`Synonyms`.`AcceptedTaxonID`) AS `accepted_name_code`,
NULL AS `comment`,
NULL AS `scrutiny_date`,
`sp2000_statuses`.`record_id` AS `sp2000_status_id`,
@dbid AS `database_id`,
NULL AS `specialist_id`,
NULL AS `family_id`,
sn.`specialist_code` AS `specialist_code`,
sn.`family_code` AS `family_code`,
0 AS `is_accepted_name`,
NULL AS `GSDTaxonGUI`,
`Synonyms`.`GSDNameGUI` AS `GSDNameGUI` 
FROM ",
@dbtouse,
".`Synonyms` Synonyms
LEFT OUTER JOIN scientific_names sn ON
CONCAT(@dbabbr,`Synonyms`.`AcceptedTaxonID`) = `sn`.`name_code`
LEFT OUTER JOIN `sp2000_statuses` ON
`Synonyms`.`Sp2000NameStatus` = `sp2000_statuses`.`sp2000_status`")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
TRUNCATE TABLE `common_names`
--------------

--------------
SET @query = CONCAT("
INSERT INTO `common_names` 
SELECT
NULL, 
CONCAT(@dbabbr, `AcceptedTaxonID`) AS `name_code`,
CONVERT(`CommonName` USING utf8) AS `common_name`,
`Transliteration` AS `transliteration`,
`Language` AS `language`,
`Country` AS `country`,
`Area` AS `area`,
 NULL AS `reference_ID`,
@dbid AS `database_ID`,
 NULL AS `is_infraspecies`,
 `ReferenceID` AS `reference_code`
 FROM ",
@dbtouse,
".`CommonNames`")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
TRUNCATE TABLE `references`
--------------

--------------
SET @query = CONCAT("
INSERT INTO `references` 
SELECT
NULL AS `record_id`, 
`Authors` AS `author`,
`Year` AS `year`,
NULL AS `title`,
`Title` AS `source`,
@dbid AS `database_id`,
CONCAT(@dbabbr, `ReferenceID`) AS `reference_code`
 FROM ",
@dbtouse,
".`References`")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
TRUNCATE TABLE `scientific_name_references`
--------------

--------------
SET @query = CONCAT("
INSERT INTO `scientific_name_references` 
SELECT
NULL AS `record_id`,
CONCAT(@dbabbr, `ID`) AS `name_code`,	
`ReferenceType` AS `reference_type`,	
NULL AS `reference_id`,
CONCAT(@dbabbr, `ReferenceID`) AS `reference_code`,
@dbid AS `database_id`
 FROM ",
@dbtouse,
".`NameReferencesLinks`")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
SET foreign_key_checks = 1
--------------

\n\n\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\n\n
\nData Loaded.
</pre>
</pre><hr><b>Backing up...</b>\n<pre>
Creating directory  23_00_06_05Apr2015
Backing up files
</pre><hr><b>Executing local editorial checks</b>\n<pre>
<pre>
Integrity and editorial checks - this may take a while depending on size of the dataset...\n
Starting local editorial transformations
--------------
UPDATE `databases` SET `taxonomic_coverage`="Animalia - Echinodermata - Asteroidea", `is_new` = 2, `taxa`="Starfish or sea stars", `coverage`="Global", `completeness` = 96, `confidence` = 5
--------------

--------------
DELETE FROM `common_names` WHERE `common_name` IS NULL OR `common_name` = ""
--------------

--------------
DELETE FROM `distribution` WHERE `distribution` IS NULL OR `distribution` = ""
--------------

--------------
DELETE FROM `references` WHERE (`title` IS NULL OR `title` = "") AND (`author` IS NULL OR `author` = "")
--------------

--------------
DELETE FROM `specialists` WHERE `specialist_name` IS NULL OR `specialist_name` = ""
--------------

--------------
DELETE FROM `scientific_names` WHERE (`species` IS NULL OR `species` LIKE "%sp.%" OR `species` LIKE "%spp.%") AND `infraspecies` IS NULL
--------------

--------------
DELETE FROM `scientific_names` WHERE `genus` IS NULL OR `genus` = "" OR genus like "% %" OR `genus` LIKE '%sp.%' OR `genus` LIKE "%spp.%"
--------------

--------------
UPDATE `scientific_names` SET `family_id` = NULL
--------------

--------------
UPDATE `scientific_names` SET `specialist_id` = NULL
--------------

--------------
UPDATE `scientific_names` SET `infraspecies_marker` = "forma" WHERE `infraspecies_marker` LIKE "f.%"
--------------

--------------
UPDATE `scientific_names` SET `infraspecies_marker` = "var." WHERE `infraspecies_marker` LIKE "Variety"
--------------

--------------
UPDATE `scientific_names` SET `infraspecies_marker` = "subsp." WHERE `infraspecies_marker` LIKE "Subspecies"
--------------

--------------
UPDATE `scientific_names` SET `sp2000_status_id` = 5 WHERE `sp2000_status_id` IS NULL AND `is_accepted_name` = 0
--------------

--------------
UPDATE `families` SET `family` = "Not assigned" WHERE `family` LIKE "% %"
--------------

--------------
UPDATE `families` SET `order` = "Not assigned" WHERE `order` LIKE "% %"
--------------

--------------
UPDATE `families` SET `class` = "Not assigned" WHERE `class` LIKE "% %"
--------------

--------------
UPDATE `families` SET `phylum` = "Not assigned" WHERE `phylum` LIKE "% %"
--------------

--------------
UPDATE `families` SET `kingdom` = "Not assigned" WHERE `kingdom` LIKE "% %"
--------------

--------------
UPDATE `families` SET `family` = "Not assigned" WHERE (`family` IS NULL OR `family` = '')
--------------

--------------
UPDATE `families` SET `order` = "Not assigned" WHERE (`order` IS NULL OR `order` = '')
--------------

--------------
UPDATE `families` SET `class` = "Not assigned" WHERE (`class` IS NULL OR `class` = '')
--------------

--------------
UPDATE `families` SET `phylum` = "Not assigned" WHERE (`phylum` IS NULL OR `phylum` = '')
--------------

--------------
UPDATE `families` SET `kingdom` = "Not assigned" WHERE (`kingdom` IS NULL OR `kingdom` = '')
--------------

--------------
UPDATE `families` SET `hierarchy_code` = CONCAT(`kingdom`,'-',`phylum`,'-',`class`,'-',`order`,'-',`family`)
--------------

--------------
UPDATE `scientific_name_references` SET `reference_type` = "NomRef" WHERE `reference_type` LIKE "subsequent type designation%"
--------------

--------------
UPDATE `scientific_name_references` SET `reference_type` = "NomRef" WHERE `reference_type` LIKE "Nom%"
--------------

--------------
UPDATE `scientific_name_references` SET `reference_type` = "TaxAccRef" WHERE `reference_type` LIKE "taxonomy source%"
--------------

--------------
UPDATE `scientific_name_references` SET `reference_type` = "TaxAccRef" WHERE `reference_type` LIKE "additional source%"
--------------

--------------
UPDATE `scientific_name_references` SET `reference_type` = "NomRef" WHERE `reference_type` LIKE "original description%"
--------------

--------------
UPDATE `scientific_name_references` SET `reference_type` = "TaxAccRef" WHERE `reference_type` LIKE "source of synonymy%"
--------------

--------------
UPDATE `scientific_name_references` SET `reference_type` = "TaxAccRef" WHERE `reference_type` LIKE "basis of record%"
--------------

--------------
UPDATE `databases` SET database_name_displayed = REPLACE(database_name_displayed,'_',' ')
--------------

--------------
UPDATE `databases` SET database_name = REPLACE(database_name,'_',' ')
--------------

--------------
UPDATE `databases` SET authors_editors = REPLACE(authors_editors, ',', '')
--------------

--------------
UPDATE `databases` SET authors_editors = REPLACE(authors_editors, ';', ',')
--------------

--------------
SELECT "Duplicate accepted names:", sn.name_code, sn.sp2000_status_id, dups.genus, dups.species, dups.infraspecies_marker, dups.infraspecies, dups.author FROM (SELECT genus, species, infraspecies_marker, infraspecies, author, sp2000_status_id, count(*) as cnt FROM scientific_names GROUP BY genus, species, infraspecies, infraspecies_marker, author, sp2000_status_id HAVING cnt > 1) dups LEFT JOIN scientific_names sn ON sn.genus = dups.genus AND sn.species = dups.species AND sn.author = dups.author WHERE sn.sp2000_status_id = 1
--------------

--------------
SELECT "Accepted name to be retained", MAX(name_code), genus, species, infraspecies_marker, infraspecies, author FROM
(SELECT sn.name_code AS name_code, sn.sp2000_status_id AS sp2000_status_id, dups.genus AS genus, dups.species AS species, dups.infraspecies_marker AS infraspecies_marker, dups.infraspecies AS infraspecies, dups.author AS author FROM (SELECT genus, species, infraspecies_marker, infraspecies, author, sp2000_status_id, count(*) as cnt FROM scientific_names GROUP BY genus, species, infraspecies, infraspecies_marker, author, sp2000_status_id HAVING cnt > 1) dups LEFT JOIN scientific_names sn
ON sn.genus = dups.genus AND sn.species = dups.species AND sn.author = dups.author WHERE sn.sp2000_status_id = 1) AS dups2 GROUP BY genus, species, infraspecies_marker, infraspecies, author
--------------

--------------
SELECT "Accepted name to be deleted", sn.name_code AS name_code, sn.sp2000_status_id AS sp2000_status_id, dups.genus AS genus, dups.species AS species, dups.infraspecies_marker AS infraspecies_marker, dups.infraspecies AS infraspecies, dups.author AS author FROM (SELECT genus, species, infraspecies_marker, infraspecies, author, sp2000_status_id, count(*) as cnt FROM scientific_names GROUP BY genus, species, infraspecies, infraspecies_marker, author, sp2000_status_id HAVING cnt > 1) dups LEFT JOIN scientific_names sn ON sn.genus = dups.genus AND sn.species = dups.species AND sn.author = dups.author WHERE sn.sp2000_status_id = 1
AND sn.name_code NOT IN (SELECT dups3.namecodes_to_keep FROM
(SELECT MAX(name_code) AS namecodes_to_keep, genus, species, infraspecies_marker, infraspecies, author FROM
(SELECT sn.name_code AS name_code, sn.sp2000_status_id AS sp2000_status_id, dups.genus AS genus, dups.species AS species, dups.infraspecies_marker AS infraspecies_marker, dups.infraspecies AS infraspecies, dups.author AS author FROM (SELECT genus, species, infraspecies_marker, infraspecies, author, sp2000_status_id, count(*) as cnt
FROM scientific_names
GROUP BY genus, species, infraspecies, infraspecies_marker, author, sp2000_status_id HAVING cnt > 1) dups
LEFT JOIN scientific_names sn
ON sn.genus = dups.genus AND sn.species = dups.species AND sn.author = dups.author WHERE sn.sp2000_status_id = 1) AS dups2 GROUP BY genus, species, infraspecies_marker, infraspecies, author) AS dups3)
--------------

--------------
SELECT 'Common name without parent accepted name', record_id, common_name, name_code FROM common_names
WHERE name_code NOT IN(SELECT DISTINCT name_code FROM scientific_names)
--------------

--------------
CREATE TEMPORARY TABLE scientific_names_tmp AS SELECT * FROM scientific_names
--------------

--------------
SELECT 'Missing parent accepted name for synonym', record_id, name_code, genus, species, infraspecies, accepted_name_code FROM scientific_names
WHERE is_accepted_name != 1 AND family_code IS NULL
--------------

Missing parent accepted name for synonym	record_id	name_code	genus	species	infraspecies	accepted_name_code
Missing parent accepted name for synonym	2060	W-Ase-379077	Asterias	borbonica		W-Ase-172534
Missing parent accepted name for synonym	2805	W-Ase-378639	Linckia	franciscus		W-Ase-123314
Missing parent accepted name for synonym	3388	W-Ase-380692	Albatrossia	nuda		W-Ase-123267
Missing parent accepted name for synonym	3651	W-Ase-381975	Marginaster	littoralis		W-Ase-123133
Missing parent accepted name for synonym	4229	W-Ase-370908	Randasia	luzonica		W-Ase-204844
Missing parent accepted name for synonym	4576	W-Ase-382114	Pedicellaster	parvulus		W-Ase-123225
--------------
SELECT 'Missing parent accepted name for infraspecies', record_id, name_code, genus, species, infraspecies, infraspecies_parent_name_code FROM scientific_names WHERE LENGTH(infraspecies)>1  AND family_code IS NULL
--------------

--------------
SELECT 'Lifezone without parent accepted name', record_id, name_code, lifezone FROM lifezone
WHERE name_code NOT IN(SELECT DISTINCT name_code FROM scientific_names)
--------------

Lifezone without parent accepted name	record_id	name_code	lifezone
Lifezone without parent accepted name	1399	W-Ase-254777	marine
--------------
SELECT 'Distribution without parent accepted name', record_id, name_code, distribution FROM distribution
WHERE name_code NOT IN(SELECT DISTINCT name_code FROM scientific_names)
--------------

--------------
SELECT 'Accepted name without parent family', record_id, name_code, genus, species, infraspecies, family_code FROM scientific_names
WHERE family_code NOT IN(SELECT DISTINCT family_code FROM families)
--------------

--------------
SELECT 'Reference link to non-existing accepted name', record_id, reference_code, name_code FROM scientific_name_references
WHERE name_code NOT IN(SELECT DISTINCT name_code FROM scientific_names)
--------------

Reference link to non-existing accepted name	record_id	reference_code	name_code
Reference link to non-existing accepted name	53	W-Ase-139319	W-Ase-123716
Reference link to non-existing accepted name	75	W-Ase-1368	W-Ase-123951
Reference link to non-existing accepted name	102	W-Ase-4179	W-Ase-172754
Reference link to non-existing accepted name	114	W-Ase-5869	W-Ase-178135
Reference link to non-existing accepted name	157	W-Ase-6324	W-Ase-213337
Reference link to non-existing accepted name	177	W-Ase-10010	W-Ase-235012
Reference link to non-existing accepted name	230	W-Ase-125374	W-Ase-370963
Reference link to non-existing accepted name	258	W-Ase-1368	W-Ase-124037
Reference link to non-existing accepted name	259	W-Ase-124623	W-Ase-124041
Reference link to non-existing accepted name	276	W-Ase-5869	W-Ase-125234
Reference link to non-existing accepted name	404	W-Ase-47471	W-Ase-380627
Reference link to non-existing accepted name	501	W-Ase-6324	W-Ase-213132
Reference link to non-existing accepted name	514	W-Ase-71	W-Ase-216169
Reference link to non-existing accepted name	674	W-Ase-5916	W-Ase-216166
Reference link to non-existing accepted name	698	W-Ase-124945	W-Ase-254889
Reference link to non-existing accepted name	738	W-Ase-1368	W-Ase-123717
Reference link to non-existing accepted name	752	W-Ase-1368	W-Ase-123917
Reference link to non-existing accepted name	793	W-Ase-6820	W-Ase-179589
Reference link to non-existing accepted name	799	W-Ase-70	W-Ase-213260
Reference link to non-existing accepted name	812	W-Ase-10011	W-Ase-234873
Reference link to non-existing accepted name	821	W-Ase-10010	W-Ase-234960
Reference link to non-existing accepted name	890	W-Ase-47480	W-Ase-123918
Reference link to non-existing accepted name	898	W-Ase-1368	W-Ase-124044
Reference link to non-existing accepted name	1034	W-Ase-1368	W-Ase-124114
Reference link to non-existing accepted name	1039	W-Ase-1368	W-Ase-125157
Reference link to non-existing accepted name	1082	W-Ase-124623	W-Ase-213244
Reference link to non-existing accepted name	1172	W-Ase-667	W-Ase-149885
Reference link to non-existing accepted name	1198	W-Ase-71	W-Ase-213135
Reference link to non-existing accepted name	1249	W-Ase-47480	W-Ase-377806
Reference link to non-existing accepted name	1270	W-Ase-6313	W-Ase-378597
Reference link to non-existing accepted name	1275	W-Ase-8	W-Ase-379538
Reference link to non-existing accepted name	1276	W-Ase-138507	W-Ase-379565
Reference link to non-existing accepted name	1285	W-Ase-1368	W-Ase-382090
Reference link to non-existing accepted name	1303	W-Ase-6313	W-Ase-378701
Reference link to non-existing accepted name	1308	W-Ase-127081	W-Ase-380329
Reference link to non-existing accepted name	1319	W-Ase-47480	W-Ase-381040
Reference link to non-existing accepted name	1357	W-Ase-125337	W-Ase-762315
Reference link to non-existing accepted name	1378	W-Ase-671	W-Ase-379048
Reference link to non-existing accepted name	1387	W-Ase-132589	W-Ase-382102
Reference link to non-existing accepted name	1446	W-Ase-139547	W-Ase-379650
Reference link to non-existing accepted name	1449	W-Ase-141249	W-Ase-380220
Reference link to non-existing accepted name	1497	W-Ase-47471	W-Ase-377876
Reference link to non-existing accepted name	1502	W-Ase-47454	W-Ase-378511
Reference link to non-existing accepted name	1507	W-Ase-43179	W-Ase-378710
Reference link to non-existing accepted name	1520	W-Ase-47480	W-Ase-381951
Reference link to non-existing accepted name	1532	W-Ase-64	W-Ase-123720
Reference link to non-existing accepted name	1551	W-Ase-1368	W-Ase-125162
Reference link to non-existing accepted name	1627	W-Ase-667	W-Ase-379142
Reference link to non-existing accepted name	1632	W-Ase-47427	W-Ase-380700
Reference link to non-existing accepted name	1644	W-Ase-125337	W-Ase-762317
Reference link to non-existing accepted name	1646	W-Ase-124647	W-Ase-765422
Reference link to non-existing accepted name	1703	W-Ase-47408	W-Ase-224147
Reference link to non-existing accepted name	1740	W-Ase-47408	W-Ase-368440
Reference link to non-existing accepted name	1766	W-Ase-1368	W-Ase-124016
Reference link to non-existing accepted name	1836	W-Ase-125364	W-Ase-368441
Reference link to non-existing accepted name	1863	W-Ase-47480	W-Ase-380348
Reference link to non-existing accepted name	1883	W-Ase-6273	W-Ase-370885
Reference link to non-existing accepted name	1932	W-Ase-5869	W-Ase-178031
Reference link to non-existing accepted name	2010	W-Ase-43179	W-Ase-378709
Reference link to non-existing accepted name	2021	W-Ase-47470	W-Ase-381784
Reference link to non-existing accepted name	2127	W-Ase-6392	W-Ase-377375
Reference link to non-existing accepted name	2128	W-Ase-6392	W-Ase-377377
Reference link to non-existing accepted name	2159	W-Ase-129889	W-Ase-573323
Reference link to non-existing accepted name	2169	W-Ase-1368	W-Ase-123791
Reference link to non-existing accepted name	2177	W-Ase-1368	W-Ase-124025
Reference link to non-existing accepted name	2179	W-Ase-1368	W-Ase-124076
Reference link to non-existing accepted name	2212	W-Ase-6324	W-Ase-221151
Reference link to non-existing accepted name	2260	W-Ase-47480	W-Ase-378535
Reference link to non-existing accepted name	2363	W-Ase-125374	W-Ase-370972
Reference link to non-existing accepted name	2407	W-Ase-1368	W-Ase-124040
Reference link to non-existing accepted name	2426	W-Ase-6324	W-Ase-216171
--------------
SELECT 'Reference link to non-existing reference', record_id, reference_code, name_code FROM scientific_name_references
WHERE reference_code NOT IN(SELECT DISTINCT reference_code FROM `references`)
--------------

Reference link to non-existing reference	record_id	reference_code	name_code
Reference link to non-existing reference	1	W-Ase-163043	W-Ase-123985
Reference link to non-existing reference	2	W-Ase-163039	W-Ase-123803
Reference link to non-existing reference	3	W-Ase-147411	W-Ase-124043
Reference link to non-existing reference	4	W-Ase-147412	W-Ase-368636
Reference link to non-existing reference	6	W-Ase-42381	W-Ase-241001
Reference link to non-existing reference	7	W-Ase-147411	W-Ase-123867
Reference link to non-existing reference	8	W-Ase-147411	W-Ase-124055
Reference link to non-existing reference	10	W-Ase-147411	W-Ase-124020
Reference link to non-existing reference	11	W-Ase-163039	W-Ase-123795
Reference link to non-existing reference	13	W-Ase-147412	W-Ase-124154
Reference link to non-existing reference	14	W-Ase-147411	W-Ase-379564
Reference link to non-existing reference	15	W-Ase-123768	W-Ase-123776
Reference link to non-existing reference	16	W-Ase-147411	W-Ase-123908
Reference link to non-existing reference	17	W-Ase-163039	W-Ase-123989
Reference link to non-existing reference	18	W-Ase-147411	W-Ase-379749
Reference link to non-existing reference	19	W-Ase-147411	W-Ase-124151
Reference link to non-existing reference	20	W-Ase-147411	W-Ase-123915
Reference link to non-existing reference	21	W-Ase-163039	W-Ase-123878
Reference link to non-existing reference	23	W-Ase-147411	W-Ase-123920
Reference link to non-existing reference	24	W-Ase-147411	W-Ase-124085
Reference link to non-existing reference	25	W-Ase-147411	W-Ase-124147
Reference link to non-existing reference	26	W-Ase-163039	W-Ase-124101
Reference link to non-existing reference	27	W-Ase-147411	W-Ase-369167
Reference link to non-existing reference	28	W-Ase-147411	W-Ase-123673
Reference link to non-existing reference	29	W-Ase-147411	W-Ase-123813
Reference link to non-existing reference	30	W-Ase-163039	W-Ase-123987
Reference link to non-existing reference	31	W-Ase-163039	W-Ase-123856
Reference link to non-existing reference	32	W-Ase-147411	W-Ase-124042
Reference link to non-existing reference	33	W-Ase-147411	W-Ase-178639
Reference link to non-existing reference	34	W-Ase-147411	W-Ase-123971
Reference link to non-existing reference	36	W-Ase-10085	W-Ase-123970
Reference link to non-existing reference	37	W-Ase-163039	W-Ase-125161
Reference link to non-existing reference	38	W-Ase-147411	W-Ase-158500
Reference link to non-existing reference	39	W-Ase-147411	W-Ase-379849
Reference link to non-existing reference	40	W-Ase-147411	W-Ase-123825
Reference link to non-existing reference	42	W-Ase-147411	W-Ase-381573
Reference link to non-existing reference	46	W-Ase-147411	W-Ase-123973
Reference link to non-existing reference	47	W-Ase-147411	W-Ase-123851
Reference link to non-existing reference	57	W-Ase-64	W-Ase-123796
Reference link to non-existing reference	67	W-Ase-64	W-Ase-123896
Reference link to non-existing reference	92	W-Ase-64	W-Ase-125168
Reference link to non-existing reference	94	W-Ase-64	W-Ase-125232
Reference link to non-existing reference	95	W-Ase-64	W-Ase-125233
Reference link to non-existing reference	168	W-Ase-10011	W-Ase-234924
Reference link to non-existing reference	175	W-Ase-10011	W-Ase-234975
Reference link to non-existing reference	179	W-Ase-10011	W-Ase-235024
Reference link to non-existing reference	180	W-Ase-10011	W-Ase-235025
Reference link to non-existing reference	263	W-Ase-64	W-Ase-124103
Reference link to non-existing reference	269	W-Ase-64	W-Ase-124167
Reference link to non-existing reference	271	W-Ase-64	W-Ase-125169
Reference link to non-existing reference	273	W-Ase-64	W-Ase-125203
Reference link to non-existing reference	274	W-Ase-64	W-Ase-125205
Reference link to non-existing reference	280	W-Ase-64	W-Ase-149896
Reference link to non-existing reference	281	W-Ase-64	W-Ase-152511
Reference link to non-existing reference	282	W-Ase-64	W-Ase-152513
Reference link to non-existing reference	315	W-Ase-6831	W-Ase-183106
Reference link to non-existing reference	342	W-Ase-10011	W-Ase-234961
Reference link to non-existing reference	349	W-Ase-10011	W-Ase-235018
Reference link to non-existing reference	353	W-Ase-43056	W-Ase-247756
Reference link to non-existing reference	417	W-Ase-64	W-Ase-123699
Reference link to non-existing reference	423	W-Ase-42	W-Ase-123808
Reference link to non-existing reference	428	W-Ase-64	W-Ase-123899
Reference link to non-existing reference	439	W-Ase-64	W-Ase-124035
Reference link to non-existing reference	451	W-Ase-64	W-Ase-124158
Reference link to non-existing reference	453	W-Ase-64	W-Ase-125171
Reference link to non-existing reference	456	W-Ase-64	W-Ase-125230
Reference link to non-existing reference	495	W-Ase-6831	W-Ase-183045
Reference link to non-existing reference	526	W-Ase-10011	W-Ase-234984
Reference link to non-existing reference	527	W-Ase-10011	W-Ase-234986
Reference link to non-existing reference	531	W-Ase-10011	W-Ase-235020
Reference link to non-existing reference	532	W-Ase-42	W-Ase-240758
Reference link to non-existing reference	586	W-Ase-64	W-Ase-123759
Reference link to non-existing reference	588	W-Ase-64	W-Ase-123802
Reference link to non-existing reference	606	W-Ase-64	W-Ase-124002
Reference link to non-existing reference	615	W-Ase-64	W-Ase-124120
Reference link to non-existing reference	620	W-Ase-64	W-Ase-124159
Reference link to non-existing reference	625	W-Ase-64	W-Ase-125231
Reference link to non-existing reference	686	W-Ase-10011	W-Ase-234994
Reference link to non-existing reference	743	W-Ase-64	W-Ase-123812
Reference link to non-existing reference	748	W-Ase-64	W-Ase-123880
Reference link to non-existing reference	749	W-Ase-64	W-Ase-123881
Reference link to non-existing reference	769	W-Ase-64	W-Ase-149867
Reference link to non-existing reference	812	W-Ase-10011	W-Ase-234873
Reference link to non-existing reference	818	W-Ase-10011	W-Ase-234941
Reference link to non-existing reference	820	W-Ase-10011	W-Ase-234958
Reference link to non-existing reference	823	W-Ase-10011	W-Ase-235005
Reference link to non-existing reference	826	W-Ase-10011	W-Ase-235022
Reference link to non-existing reference	874	W-Ase-64	W-Ase-123740
Reference link to non-existing reference	878	W-Ase-64	W-Ase-123783
Reference link to non-existing reference	883	W-Ase-64	W-Ase-123842
Reference link to non-existing reference	888	W-Ase-64	W-Ase-123910
Reference link to non-existing reference	894	W-Ase-64	W-Ase-123949
Reference link to non-existing reference	909	W-Ase-64	W-Ase-125153
Reference link to non-existing reference	915	W-Ase-64	W-Ase-149889
Reference link to non-existing reference	916	W-Ase-64	W-Ase-152497
Reference link to non-existing reference	917	W-Ase-42	W-Ase-158491
Reference link to non-existing reference	961	W-Ase-10011	W-Ase-234868
Reference link to non-existing reference	966	W-Ase-10011	W-Ase-234902
Reference link to non-existing reference	967	W-Ase-10011	W-Ase-234911
Reference link to non-existing reference	970	W-Ase-10011	W-Ase-234936
Reference link to non-existing reference	972	W-Ase-10011	W-Ase-234979
Reference link to non-existing reference	976	W-Ase-10011	W-Ase-235004
Reference link to non-existing reference	977	W-Ase-10011	W-Ase-235009
Reference link to non-existing reference	1033	W-Ase-64	W-Ase-124108
Reference link to non-existing reference	1042	W-Ase-42	W-Ase-158493
Reference link to non-existing reference	1094	W-Ase-10011	W-Ase-234870
Reference link to non-existing reference	1096	W-Ase-10011	W-Ase-234904
Reference link to non-existing reference	1097	W-Ase-10011	W-Ase-234909
Reference link to non-existing reference	1102	W-Ase-10011	W-Ase-234968
Reference link to non-existing reference	1104	W-Ase-10011	W-Ase-235002
Reference link to non-existing reference	1106	W-Ase-10011	W-Ase-235806
Reference link to non-existing reference	1140	W-Ase-64	W-Ase-123775
Reference link to non-existing reference	1162	W-Ase-64	W-Ase-124118
Reference link to non-existing reference	1168	W-Ase-64	W-Ase-124161
Reference link to non-existing reference	1173	W-Ase-64	W-Ase-149890
Reference link to non-existing reference	1210	W-Ase-10011	W-Ase-234860
Reference link to non-existing reference	1212	W-Ase-10011	W-Ase-234903
Reference link to non-existing reference	1213	W-Ase-10011	W-Ase-234953
Reference link to non-existing reference	1216	W-Ase-10011	W-Ase-234996
Reference link to non-existing reference	1217	W-Ase-10011	W-Ase-235003
Reference link to non-existing reference	1277	W-Ase-10011	W-Ase-379852
Reference link to non-existing reference	1532	W-Ase-64	W-Ase-123720
Reference link to non-existing reference	1539	W-Ase-64	W-Ase-123873
Reference link to non-existing reference	1554	W-Ase-64	W-Ase-149892
Reference link to non-existing reference	1555	W-Ase-64	W-Ase-149894
Reference link to non-existing reference	1572	W-Ase-6831	W-Ase-183351
Reference link to non-existing reference	1585	W-Ase-42	W-Ase-240771
Reference link to non-existing reference	1704	W-Ase-10011	W-Ase-234871
Reference link to non-existing reference	1708	W-Ase-10011	W-Ase-234971
Reference link to non-existing reference	1709	W-Ase-10011	W-Ase-235807
Reference link to non-existing reference	1710	W-Ase-42	W-Ase-240764
Reference link to non-existing reference	1716	W-Ase-42936	W-Ase-242159
Reference link to non-existing reference	1754	W-Ase-64	W-Ase-123763
Reference link to non-existing reference	1776	W-Ase-64	W-Ase-124163
Reference link to non-existing reference	1778	W-Ase-64	W-Ase-152507
Reference link to non-existing reference	1814	W-Ase-10011	W-Ase-234905
Reference link to non-existing reference	1819	W-Ase-42936	W-Ase-242157
Reference link to non-existing reference	1959	W-Ase-42940	W-Ase-242164
Reference link to non-existing reference	2216	W-Ase-10011	W-Ase-234964
Reference link to non-existing reference	2217	W-Ase-42	W-Ase-240755
Reference link to non-existing reference	2318	W-Ase-6831	W-Ase-183364
Reference link to non-existing reference	2329	W-Ase-42	W-Ase-242156
Reference link to non-existing reference	2412	W-Ase-64	W-Ase-149893
Reference link to non-existing reference	2413	W-Ase-64	W-Ase-152501
Reference link to non-existing reference	2422	W-Ase-6831	W-Ase-183352
--------------
SELECT 'Specialist not present in scientific names table', record_id, specialist_name, specialist_code FROM specialists
WHERE specialist_code NOT IN(SELECT DISTINCT specialist_code FROM scientific_names)
--------------

--------------
SELECT 'Reference without parent accepted or common name', record_id, author, year, title, reference_code FROM `references`
WHERE reference_code NOT IN(SELECT DISTINCT reference_code FROM scientific_name_references 
UNION SELECT DISTINCT reference_code FROM common_names)
--------------

Reference without parent accepted or common name	record_id	author	year	title	reference_code
Reference without parent accepted or common name	3	Cattrijsse, A.; Vincx, M.	2001	NULL	W-Ase-61
Reference without parent accepted or common name	8	Hayward, P.J.; Nelson-Smith, A.; Shields, C.	1996	NULL	W-Ase-614
Reference without parent accepted or common name	9	Hansson, H.G. (Comp.)	1998	NULL	W-Ase-631
Reference without parent accepted or common name	15	Eneman, E.	1984	NULL	W-Ase-755
Reference without parent accepted or common name	16	Leewis, R.	2002	NULL	W-Ase-1116
Reference without parent accepted or common name	20	Gosner, K.L.	1971	NULL	W-Ase-2964
Reference without parent accepted or common name	21	Gosner,	1977	NULL	W-Ase-2965
Reference without parent accepted or common name	23	Meinkoth, N.A.	1981	NULL	W-Ase-3017
Reference without parent accepted or common name	25	Trott, T.J.	2004	NULL	W-Ase-3072
Reference without parent accepted or common name	30	Bell, F.J.	1884	NULL	W-Ase-5938
Reference without parent accepted or common name	39	Dcary, R.	1924	NULL	W-Ase-6268
Reference without parent accepted or common name	49	Clark AH	1911	NULL	W-Ase-6325
Reference without parent accepted or common name	55	Clark, A.H.	1908	NULL	W-Ase-6342
Reference without parent accepted or common name	62	Thomson, C. W.	1873	NULL	W-Ase-8316
Reference without parent accepted or common name	63	Southward, E.C.; Campbell, A.C.	2006	NULL	W-Ase-9214
Reference without parent accepted or common name	70	Montagu, G.	1808	NULL	W-Ase-19343
Reference without parent accepted or common name	72	Leach, W.E.	1815	NULL	W-Ase-21978
Reference without parent accepted or common name	91	Clark A.M.	1962	NULL	W-Ase-47404
Reference without parent accepted or common name	99	Downey, M. E.	1980	NULL	W-Ase-47415
Reference without parent accepted or common name	103	Halpern, J. A.	1969	NULL	W-Ase-47419
Reference without parent accepted or common name	116	Clark, H. E. S.	1982	NULL	W-Ase-47438
Reference without parent accepted or common name	121	Jangoux, M.	1981	NULL	W-Ase-47448
Reference without parent accepted or common name	123	Dderlein, L.	1922	NULL	W-Ase-47451
Reference without parent accepted or common name	128	Downey, M. E.	1972	NULL	W-Ase-47460
Reference without parent accepted or common name	135	Sars, G.O.	1875	NULL	W-Ase-47477
Reference without parent accepted or common name	137	Fujita, T. and F.W.E. Rowe.	2002	NULL	W-Ase-47481
Reference without parent accepted or common name	138	Clark, A. M.; Wright, C. W.	1962	NULL	W-Ase-47482
Reference without parent accepted or common name	144	Downey, M.E.	1970	NULL	W-Ase-47494
Reference without parent accepted or common name	145	Downey, M. E.	1971	NULL	W-Ase-47495
Reference without parent accepted or common name	156	Downey, M. E.	1971	NULL	W-Ase-47518
Reference without parent accepted or common name	158	Downey, M. E.	1979	NULL	W-Ase-47520
Reference without parent accepted or common name	168	Rowe, F.W.E.	1989	NULL	W-Ase-124596
Reference without parent accepted or common name	169	Baker, A.N., F.W.E. Rowe, H.E.S. Clark.	1986	NULL	W-Ase-124600
Reference without parent accepted or common name	172	Rowe, F. W. E. and E. L. Albertson.	1986	NULL	W-Ase-124603
Reference without parent accepted or common name	174	Mortensen, T.	1935	NULL	W-Ase-124605
Reference without parent accepted or common name	179	Rowe, F. W. E.	1976	NULL	W-Ase-124611
Reference without parent accepted or common name	182	Cherbonnier, G.	1970	NULL	W-Ase-124617
Reference without parent accepted or common name	185	Gray J.E.	1847	NULL	W-Ase-124624
Reference without parent accepted or common name	186	Mbius,K.	1859	NULL	W-Ase-124634
Reference without parent accepted or common name	190	Fisher, W. K.	1917	NULL	W-Ase-124646
Reference without parent accepted or common name	192	Fisher, W.K.	1926	NULL	W-Ase-124652
Reference without parent accepted or common name	193	Fisher, W. K.	1905	NULL	W-Ase-124657
Reference without parent accepted or common name	201	Leeling, B.	1984	NULL	W-Ase-124961
Reference without parent accepted or common name	203	Harvey, R.	1989	NULL	W-Ase-124965
Reference without parent accepted or common name	211	Dons, C.	1936	NULL	W-Ase-125307
Reference without parent accepted or common name	220	Miller, J. E.	1984	NULL	W-Ase-125340
Reference without parent accepted or common name	222	Howell K L A D Rogers; Tyler, P. A.; Billett, D. S. M.	2004	NULL	W-Ase-125349
Reference without parent accepted or common name	224	Williams, S. T.	2000	NULL	W-Ase-125360
Reference without parent accepted or common name	228	Ltken, C.	1871	NULL	W-Ase-125719
Reference without parent accepted or common name	242	Downey, M. E.	1981	NULL	W-Ase-125927
Reference without parent accepted or common name	244	Marsh, L.M.	1991	NULL	W-Ase-125951
Reference without parent accepted or common name	262	McKnight.	2006	NULL	W-Ase-128965
Reference without parent accepted or common name	265	Clark, A. H.	1931	NULL	W-Ase-129946
Reference without parent accepted or common name	271	Clark, H. E. S.	2001	NULL	W-Ase-133489
Reference without parent accepted or common name	274	Clark, A.; Clark, A.	1967	NULL	W-Ase-133557
Reference without parent accepted or common name	278	Madsen, F. J.	1987	NULL	W-Ase-138505
Reference without parent accepted or common name	285	Kogure, Y. A. K.; Nonaka, M.	2009	NULL	W-Ase-140262
Reference without parent accepted or common name	286	McKnight, D. G.	1977	NULL	W-Ase-141189
Reference without parent accepted or common name	289	Emson, R. G.; Crump, R. H.	1979	NULL	W-Ase-141275
Reference without parent accepted or common name	296	Bousfield, E.L.	1964	NULL	W-Ase-145894
Reference without parent accepted or common name	302	Dilman, A.B.	2005	NULL	W-Ase-149347
Reference without parent accepted or common name	320	Belyaev, G. M.	1974	NULL	W-Ase-181835
Reference without parent accepted or common name	321	Belyaev, G. M.; Litvinova, N. M.	1991	NULL	W-Ase-181836
Reference without parent accepted or common name	326	Sibuet, M	1976	NULL	W-Ase-196889
--------------
DROP TRIGGER IF EXISTS delfamcascade
--------------

--------------
DROP TRIGGER IF EXISTS delrefscascade
--------------

--------------
DROP TRIGGER IF EXISTS delspcascade
--------------

--------------
CREATE TEMPORARY TABLE duplicates_to_delete AS SELECT "Accepted name to be deleted", sn.name_code AS name_code, sn.sp2000_status_id AS sp2000_status_id, dups.genus AS genus, dups.species AS species, dups.infraspecies_marker AS infraspecies_marker, dups.infraspecies AS infraspecies, dups.author AS author FROM (SELECT genus, species, infraspecies_marker, infraspecies, author, sp2000_status_id, count(*) as cnt FROM scientific_names GROUP BY genus, species, infraspecies, infraspecies_marker, author, sp2000_status_id HAVING cnt > 1) dups LEFT JOIN scientific_names sn ON sn.genus = dups.genus AND sn.species = dups.species AND sn.author = dups.author WHERE sn.sp2000_status_id = 1
AND sn.name_code NOT IN (SELECT dups3.namecodes_to_keep FROM
(SELECT MAX(name_code) AS namecodes_to_keep, genus, species, infraspecies_marker, infraspecies, author FROM
(SELECT sn.name_code AS name_code, sn.sp2000_status_id AS sp2000_status_id, dups.genus AS genus, dups.species AS species, dups.infraspecies_marker AS infraspecies_marker, dups.infraspecies AS infraspecies, dups.author AS author FROM (SELECT genus, species, infraspecies_marker, infraspecies, author, sp2000_status_id, count(*) as cnt
FROM scientific_names
GROUP BY genus, species, infraspecies, infraspecies_marker, author, sp2000_status_id HAVING cnt > 1) dups
LEFT JOIN scientific_names sn
ON sn.genus = dups.genus AND sn.species = dups.species AND sn.author = dups.author WHERE sn.sp2000_status_id = 1) AS dups2 GROUP BY genus, species, infraspecies_marker, infraspecies, author) AS dups3)
--------------

--------------
DELETE QUICK FROM scientific_names USING scientific_names INNER JOIN duplicates_to_delete ON scientific_names.name_code = duplicates_to_delete.name_code
--------------

--------------
DELETE FROM common_names WHERE name_code NOT IN(SELECT DISTINCT name_code FROM scientific_names)
--------------

--------------
DELETE QUICK FROM scientific_names WHERE is_accepted_name != 1 AND accepted_name_code NOT IN(SELECT DISTINCT name_code FROM scientific_names_tmp)
--------------

--------------
DELETE QUICK FROM scientific_names WHERE infraspecies_parent_name_code NOT IN(SELECT DISTINCT name_code FROM scientific_names_tmp)
--------------

--------------
DELETE QUICK FROM lifezone WHERE name_code NOT IN(SELECT DISTINCT name_code FROM scientific_names)
--------------

--------------
OPTIMIZE TABLE lifezone
--------------

Table	Op	Msg_type	Msg_text
Assembly_Asteroidea.lifezone	optimize	status	OK
--------------
DELETE QUICK FROM distribution WHERE name_code NOT IN(SELECT DISTINCT name_code FROM scientific_names)
--------------

--------------
OPTIMIZE TABLE distribution
--------------

Table	Op	Msg_type	Msg_text
Assembly_Asteroidea.distribution	optimize	status	OK
--------------
DELETE QUICK FROM scientific_names WHERE family_code NOT IN(SELECT DISTINCT family_code FROM families)
--------------

--------------
OPTIMIZE TABLE scientific_names
--------------

Table	Op	Msg_type	Msg_text
Assembly_Asteroidea.scientific_names	optimize	status	OK
--------------
DELETE QUICK FROM scientific_name_references WHERE name_code NOT IN(SELECT DISTINCT name_code FROM scientific_names)
--------------

--------------
DELETE QUICK FROM scientific_name_references WHERE reference_code NOT IN(SELECT DISTINCT reference_code FROM `references`)
--------------

--------------
OPTIMIZE TABLE scientific_name_references
--------------

Table	Op	Msg_type	Msg_text
Assembly_Asteroidea.scientific_name_references	optimize	status	OK
--------------
DELETE FROM specialists WHERE specialist_code NOT IN(SELECT DISTINCT specialist_code FROM scientific_names)
--------------

--------------
DELETE QUICK FROM `references` WHERE reference_code NOT IN(SELECT DISTINCT reference_code FROM scientific_name_references 
UNION SELECT DISTINCT reference_code FROM common_names)
--------------

--------------
OPTIMIZE TABLE `references`
--------------

Table	Op	Msg_type	Msg_text
Assembly_Asteroidea.references	optimize	status	OK
--------------
DROP TRIGGER IF EXISTS delfamcascade
--------------

--------------
DROP TRIGGER IF EXISTS delspcascade
--------------

--------------
DROP TRIGGER IF EXISTS delrefscascade
--------------

--------------
CREATE TRIGGER delfamcascade AFTER DELETE ON `families`
FOR EACH ROW 
BEGIN

DELETE FROM `scientific_names` WHERE family_code = old.family_code;

END;

CREATE TRIGGER delspcascade AFTER DELETE ON `scientific_names`
FOR EACH ROW 
BEGIN

DELETE FROM `common_names` WHERE name_code = old.name_code;
DELETE FROM `distribution` WHERE name_code = old.name_code;
DELETE FROM `lifezone` WHERE name_code = old.name_code;
DELETE FROM `scientific_name_references` WHERE name_code = old.name_code;
DELETE FROM `common_names` WHERE name_code = old.name_code;

END;

CREATE TRIGGER delrefscascade AFTER DELETE ON `scientific_name_references`
FOR EACH ROW 
BEGIN

DELETE FROM `references` WHERE reference_code = old.reference_code;

END;
--------------

\n\n\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n
</pre>
<pre>
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\n\n
\nEditorial and Integrity checks Completed.
</pre>
</pre><hr><b>Replacing sectors in Assembly Global database</b>\n<pre>
<pre>
Starting Sector Management
--------------
SET @dbid = 95
--------------

--------------
SET @dbtouse = 'Assembly_Global'
--------------

--------------
SET @query = CONCAT("
DELETE FROM ",
@dbtouse,
".`databases` WHERE `record_id` = @dbid")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
SET @dbtouse = 'Assembly_Global'
--------------

--------------
SET @query = CONCAT("
INSERT INTO ", @dbtouse, ".`families` SELECT 
NULL AS `record_id`,
`hierarchy_code`,	
`kingdom`,	
`phylum`,	
`class`,	
`order`,	
`family`,	
`superfamily`, 	
`database_id`, 	
`family_code`,
`is_accepted_name`
FROM  `families`")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
SET @query = CONCAT("
INSERT INTO ", @dbtouse, ".`databases` SELECT 
`database_name_displayed`, 
`record_id`, 
`database_name`, 
`database_full_name`, 
`web_site`, 
`organization`, 
`contact_person`, 
`taxa`, 
`taxonomic_coverage`, 
`abstract`, 
`version`, 
`release_date`, 
`SpeciesCount`, 
`SpeciesEst`, 
`authors_editors`, 
`accepted_species_names`, 
`accepted_infraspecies_names`, 
`species_synonyms`, 
`infraspecies_synonyms`, 
`common_names`, 
`total_names`, 
`is_new`,
`coverage`,
`completeness`,
`confidence`
FROM `databases`")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
SET @query = CONCAT("
INSERT INTO ", @dbtouse, ".`scientific_names` 
(`record_id`, `name_code`, `web_site`, `genus`, `subgenus`, `species`, `infraspecies_parent_name_code`, `infraspecies`, `infraspecies_marker`, `author`, `accepted_name_code`, `comment`, `scrutiny_date`, `sp2000_status_id`, `database_id`, `specialist_id`, `family_id`, `specialist_code`, `family_code`, `is_accepted_name`, `GSDTaxonGUID`, `GSDNameGUID`) SELECT 
NULL AS `record_id`, 
`name_code`, 
`web_site`, 
`genus`, 
`subgenus`, 
`species`, 
`infraspecies_parent_name_code`, 
`infraspecies`, 
`infraspecies_marker`, 
`author`, 
`accepted_name_code`, 
`comment`, 
`scrutiny_date`, 
`sp2000_status_id`, 
`database_id`, 
`specialist_id`, 
`family_id`, 
`specialist_code`, 
`family_code`, 
`is_accepted_name`, 
`GSDTaxonGUID`, 
`GSDNameGUID`
FROM `scientific_names`")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
SET @query = CONCAT("
INSERT INTO ", @dbtouse, ".`common_names` SELECT 
NULL AS `record_id`, 
`name_code`, 
`common_name`, 
`transliteration`, 
`language`, 
`country`, 
`area`, 
NULL AS `reference_id`, 
`database_id`, 
`is_infraspecies`, 
`reference_code`
FROM  `common_names`")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
SET @query = CONCAT("
INSERT INTO ", @dbtouse, ".`distribution` SELECT 
NULL AS `record_id`, 
`name_code`, 
`distribution`, 
`StandardInUse`, 
`DistributionStatus`,
`database_id`
FROM  `distribution`")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
SET @query = CONCAT("
INSERT INTO ", @dbtouse, ".`lifezone` SELECT 
NULL AS `record_id`,
`name_code`, 	
`lifezone`,
`database_id`
FROM  `lifezone`")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
SET @query = CONCAT("
INSERT INTO ", @dbtouse, ".`scientific_name_references` SELECT 
NULL AS `record_id`,
`name_code`,	
`reference_type`, 	
NULL AS `reference_id`,	
`reference_code`,
`database_id`
FROM  `scientific_name_references`")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
SET @query = CONCAT("
INSERT INTO ", @dbtouse, ".`references` SELECT 
NULL AS `record_id`, 
`author`, 
`year`, 
`title`, 
`source`, 
`database_id`, 
`reference_code`
FROM  `references`")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

--------------
SET @query = CONCAT("
INSERT INTO ", @dbtouse, ".`specialists` SELECT 
NULL AS `record_id`,
`specialist_name`,
`specialist_code`,
`database_id`
FROM  `specialists`")
--------------

--------------
PREPARE stmt FROM @query
--------------

--------------
EXECUTE stmt
--------------

--------------
DEALLOCATE PREPARE stmt
--------------

\n\n\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\n\n
\nTransformations Completed.
<pre>
</pre><hr><b>Chain completed</b>
</body></html>
